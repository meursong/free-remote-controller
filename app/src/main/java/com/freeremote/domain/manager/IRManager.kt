package com.freeremote.domain.manager

import android.content.Context
import android.hardware.ConsumerIrManager
import android.os.Build
import dagger.hilt.android.qualifiers.ApplicationContext
import javax.inject.Inject
import javax.inject.Singleton

@Singleton
class IRManager @Inject constructor(
    @ApplicationContext private val context: Context
) {
    private val irManager: ConsumerIrManager? = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
        context.getSystemService(Context.CONSUMER_IR_SERVICE) as? ConsumerIrManager
    } else {
        null
    }

    fun hasIrEmitter(): Boolean {
        return irManager?.hasIrEmitter() ?: false
    }

    fun transmit(frequency: Int, pattern: IntArray): Boolean {
        return try {
            irManager?.transmit(frequency, pattern)
            true
        } catch (e: Exception) {
            e.printStackTrace()
            false
        }
    }

    fun getCarrierFrequencies(): Array<ConsumerIrManager.CarrierFrequencyRange>? {
        return if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {
            irManager?.carrierFrequencies
        } else {
            null
        }
    }

    // Common IR codes for different devices
    object IRCodes {
        // Samsung TV codes - 실제 Samsung TV 프로토콜 기반
        val SAMSUNG_TV = mapOf(
            "POWER" to IRCode(38000, intArrayOf(
                // Samsung NEC protocol - Address: 0x07, Command: 0x02
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "VOL_UP" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "VOL_DOWN" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562,
                562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "CH_UP" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 1687, 562, 562, 562, 562, 562, 1687, 562, 562, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "CH_DOWN" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "MUTE" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562,
                562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "OK" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 1687, 562, 1687, 562, 562, 562, 1687, 562, 1687, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "UP" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 1687, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "DOWN" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 1687, 562, 562, 562, 1687, 562, 562, 562, 562, 562, 1687, 562, 562, 562, 562,
                562, 562, 562, 1687, 562, 562, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 1687, 562, 562, 562, 1687, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "LEFT" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 1687, 562, 562, 562, 1687, 562, 562, 562, 1687, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "RIGHT" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 1687, 562, 562, 562, 562, 562, 1687, 562, 562, 562, 1687, 562, 562, 562, 562,
                562, 562, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 1687, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "MENU" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 1687, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "HOME" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 1687, 562, 1687, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 562, 562, 562,
                562, 562, 562, 562, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 1687, 562, 1687, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "BACK" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            // 숫자 버튼들
            "NUM_0" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 1687, 562, 562, 562, 562, 562, 562, 562, 1687, 562, 562, 562, 562, 562, 562,
                562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 1687, 562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            )),
            "NUM_1" to IRCode(38000, intArrayOf(
                9000, 4500,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562,
                562, 1687, 562, 1687, 562, 1687, 562, 562, 562, 562, 562, 562, 562, 562, 562, 1687,
                562, 562, 562, 562, 562, 562, 562, 1687, 562, 1687, 562, 1687, 562, 1687, 562, 562,
                562, 39375
            ))
        )

        // LG TV codes - 실제 LG 프로토콜 기반
        val LG_TV = mapOf(
            "POWER" to IRCode(38000, intArrayOf(
                9000, 4500,
                560, 560, 560, 560, 560, 560, 560, 1690, 560, 560, 560, 560, 560, 560, 560, 560,
                560, 560, 560, 560, 560, 560, 560, 560, 560, 1690, 560, 1690, 560, 1690, 560, 1690,
                560, 560, 560, 560, 560, 560, 560, 1690, 560, 560, 560, 560, 560, 560, 560, 560,
                560, 1690, 560, 1690, 560, 1690, 560, 560, 560, 1690, 560, 1690, 560, 1690, 560, 1690,
                560, 39950
            )),
            "VOL_UP" to IRCode(38000, intArrayOf(
                9000, 4500,
                560, 560, 560, 560, 560, 560, 560, 1690, 560, 560, 560, 560, 560, 560, 560, 560,
                560, 560, 560, 1690, 560, 560, 560, 560, 560, 1690, 560, 1690, 560, 1690, 560, 1690,
                560, 560, 560, 560, 560, 560, 560, 1690, 560, 560, 560, 560, 560, 560, 560, 560,
                560, 1690, 560, 1690, 560, 1690, 560, 560, 560, 1690, 560, 1690, 560, 1690, 560, 1690,
                560, 39950
            )),
            "VOL_DOWN" to IRCode(38000, intArrayOf(
                9000, 4500,
                560, 560, 560, 560, 560, 560, 560, 1690, 560, 560, 560, 560, 560, 560, 560, 560,
                560, 1690, 560, 1690, 560, 560, 560, 560, 560, 1690, 560, 1690, 560, 1690, 560, 1690,
                560, 560, 560, 560, 560, 560, 560, 1690, 560, 560, 560, 560, 560, 560, 560, 560,
                560, 560, 560, 560, 560, 1690, 560, 560, 560, 1690, 560, 1690, 560, 1690, 560, 1690,
                560, 39950
            ))
        )
    }

    data class IRCode(
        val frequency: Int,
        val pattern: IntArray
    ) {
        override fun equals(other: Any?): Boolean {
            if (this === other) return true
            if (javaClass != other?.javaClass) return false

            other as IRCode

            if (frequency != other.frequency) return false
            if (!pattern.contentEquals(other.pattern)) return false

            return true
        }

        override fun hashCode(): Int {
            var result = frequency
            result = 31 * result + pattern.contentHashCode()
            return result
        }
    }
}